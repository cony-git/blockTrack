<!DOCTYPE html>
<html lang="en">
<meta name="viewport" content="height=device-height, initial-scale=0.68">
<meta charset="UTF-8">
<head>
<title>BlockTrack</title>
<script src="bundle.js"></script>
<style>
input[type=submit]{background-color: #008CBA;} 
input[type=submit]:hover {
  background-color: #45a049;
}
input[type=text], input[type=password],select {
  width:300px;
  padding: 8px 10px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
}
div {
  border-radius: 5px;
  background-color: #f2f2f2;
  padding: 20px;
  height: 100%;
}
table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}
td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}
tr:nth-child(even) {
  background-color: #dddddd;
}
button {
  width: auto;
  background-color: #4CAF50;
  color: white;
  padding: 10px 8px;
  margin: 8px 0;
  border: none;
  border-radius: 10px;
  cursor: pointer;
}
button:active {
    background-color: rgb(0, 81, 125);
  }
.message-box {
    background-color: rgb(70, 190, 255);
    width: 350px;
    text-align: center;
    border-radius: 10px;
    margin: 0 auto;
    padding: 2px;
}
button:hover {
    opacity: 0.7;
} 
</style>
</head>
<body>
  <center><h1>Goods Transport And Tracking System on Hyperledger Fabric</h1></center>
<div style="text-align:center;">
<h2>Book Consignment</h2>
        <form>
        Date:<input id="date" type="text" /> <br />
        From: <input id="from" type="text" /> <br />
        To: <input id="to" type="text" /> <br />
        Consigner Name: <input id="consignerName" type="text" /> <br />
        Address: <input id="consignerAddress" type="text" /> <br />
        Mobile: <input id="consignerMobile" type="text" /> <br />
        Consignee Name: <input id="consigneeName" type="text" /> <br />
        Address: <input id="consigneeAddress" type="text" /> <br />
        Mobile: <input id="consigneeMobile" type="text" /> <br />
        Item Name: <input id="itemName" type="text" /> <br />
        Weight: <input id="itemWeight" type="text" /> <br />
        Frieght Charges: <input id="frieghtCharges" type="text" /> <br />
    </form>
    <button onclick="bookConsignment()">Submit</button>
</br>
<h2>Update Consignment</h2>
        <form>
        Admin Id: <input id="adminId" type="text" /> <br />
        Access Key: <input id="key" type="password" /> <br />
        Consignment Id: <input id="consignmentId" type="text" /> <br />
        Shipment Details: <input id="shipmentDetails" type="text" /> <br />
    </form>
        <button onclick="updateShipment()">Submit</button>
      </br>

 <h2>Track Consignment</h2>
       <form>
        Tracking Id: <input id="trackingId" placeholder="Enter Tracking Id or Invoice Id.." type="text" />
    </form>
  <button onclick="trackConsignment()">Submit</button>
</br>
<span id="getResult"></span>
<script>
   var XooaClient = XooaClient()
    XooaClient.setApiToken("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcGlLZXkiOiJXNkE1MlE5LVNDWjRTS1ctSlFLS1hEVC0wVkpKU0pEIiwiQXBpU2VjcmV0Ijoia0Jrb3VjdnZyNmh1ZWZ4IiwiUGFzc3BocmFzZSI6IjA0NDEyZDE1NzJkZGJjNzExNjJjMGRhY2Q1NjM1ZDBlIiwiaWF0IjoxNTc0NDk0NzYxfQ.JBqiN81r_qn4WGVxD5peL3X55b1B2RhCWAZPEHxQS8A");
   
function bookConsignment() {
                  let  from=document.getElementById('from').value
                  let  to = document.getElementById('to').value
                  let  consignerName = document.getElementById('consignerName').value
                  let  consignerAddress = document.getElementById('consignerAddress').value
                  let  consignerMobile = document.getElementById('consignerMobile').value
                  let    consigneeName = document.getElementById('consigneeName').value
                  let consigneeAddress = document.getElementById('consigneeAddress').value
                  let   consigneeMobile = document.getElementById('consigneeMobile').value
                  let  itemName = document.getElementById('itemName').value
                  let itemWeight=document.getElementById('itemWeight').value
                  let  frieghtCharges = document.getElementById('frieghtCharges').value
                  let date = document.getElementById('date').value

     XooaClient.invoke("bookConsignment", {}, {args: [from,to,consignerName,consignerAddress,consignerMobile,consigneeName,consigneeAddress,consigneeMobile,itemName,itemWeight,frieghtCharges,date]}, function (error, pendingResponse, data) {
            if (error) throw error;
            alert(data.payload);
        })   
   }
function trackConsignment() {
         let trackingId = document.getElementById('trackingId').value
      XooaClient.query("trackConsignment", {}, {args: [trackingId]}, function (error, pendingResponse, response) {
            if (error) {throw error;}
             if (response.payload=="Error:Item With this Id Doesnt Exist..!" || response.payload=="Error:Not a Consignment.!"){
                let sectionsContent = ''
                document.querySelector('#getResult').innerHTML = sectionsContent;
                alert(response.payload);
              }else{
                 let data = JSON.stringify(response.payload);
                 let resp = JSON.parse(data);
                 console.log(resp);
                if(typeof resp.CurrentLocation=="undefined"){
                //Proceedings for invoice
                 let sectionContent= `<table>
   <tr>
   <th>Booking Date</th>
    <th>Item Name</th>
    <th>From</th>
    <th>To</th>
    <th>Consigner</th>
    <th>Consigner Address</th>
    <th>Mobile</th>
    <th>Consignee</th>
    <th>Consignee Address</th>
    <th>Mobile</th>
    <th>Item Weight</th>
    <th>Frieght Charges</th>
    <th>Invoice Id</th>
    <th>Tracking Id</th>
    </tr>
    <tr>
    <td>${resp.Date}</td>
    <td>${resp.ItemName}</td>
    <td>${resp.From}</td>
    <td>${resp.To}</td>
    <td>${resp.consignerName}</td>
    <td>${resp.consignerAddress}</td>
    <td>${resp.consignerMobile}</td>
    <td>${resp.consigneeName}</td>
    <td>${resp.consigneeAddress}</td>
    <td>${resp.consigneeMobile}</td>
    <td>${resp.ItemWeight}</td>
    <td>${resp.FrieghtCharges}</td>
    <td>${resp.InvoiceId}</td>
    <td>${resp.TrackingId}</td>
  </tr>
  </table>`
 document.querySelector('#getResult').innerHTML = sectionContent;            
  }else{
    //Proceedings for Tracking
  let sectionContent= `<table>
   <tr>
    <th>Item Name</th>
    <th>From</th>
    <th>To</th>
    <th>Current Location</th>
    </tr>
    <tr>
    <td>${resp.ItemName}</td>
    <td>${resp.From}</td>
    <td>${resp.To}</td>
    <td>${resp.CurrentLocation}</td>
  </tr>
  </table>`
 document.querySelector('#getResult').innerHTML = sectionContent;
         }
      }

   });     

 }
function updateShipment() {

              let adminId= document.getElementById('adminId').value
              let key= document.getElementById('key').value
              let consignmentId= document.getElementById('consignmentId').value
              let shipmentDetails= document.getElementById('shipmentDetails').value
                     
      XooaClient.invoke("updateShipment", {}, {args: [adminId,key,consignmentId,shipmentDetails]}, function (error, pendingResponse, data) {
            if (error) throw error;
            alert(data.payload);
        })    

    }
</script>
</body>
</html>
